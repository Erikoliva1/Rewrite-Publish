Okay, here's a comprehensive `README.md` file for your GitHub repository. It covers the project's purpose, features, setup, usage, and important notes.

---

# The Rim Online - AI News Rewriter & WordPress Publisher

![The Rim Online Logo](static/watermark.png)

This project is a web application designed to streamline the news publishing workflow for "The Rim Online". It leverages advanced AI models to rewrite news articles in standard journalistic Nepali and provides seamless integration with a WordPress site for publishing, including automated image watermarking and upload.

## ‚ú® Features

*   **AI-Powered News Rewriting:**
    *   Utilizes various large language models (LLMs) from Azure AI Inference, OpenRouter, and Puter.com (including GPT-4.1, DeepSeek, Grok, Claude, Gemma, Llama, Qwen, and more) to rewrite news articles.
    *   Generates short, relevant headlines and rewrites content in a new style and structure while preserving originality and paragraph count.
    *   Supports multiple AI models for flexibility and comparison.
*   **WordPress Integration:**
    *   **Automated Publishing:** Publishes rewritten news directly to a WordPress site.
    *   **Dynamic Category Selection:** Fetches and displays WordPress categories for easy selection.
    *   **Intelligent Auto-Tagging:** Automatically suggests and applies relevant tags based on news content keywords (e.g., "‡§∏‡•Å‡§®", "‡§∂‡•á‡§Ø‡§∞", "‡§ñ‡•á‡§≤").
    *   **Post Status Control:** Publish articles immediately or save them as drafts.
*   **Image Management:**
    *   **Client-Side Watermarking:** Applies a custom watermark to featured images directly in the browser.
    *   **Direct WordPress Upload:** Proxies watermarked images directly to the WordPress media library, returning a media ID for post association.
*   **Secure Authentication:**
    *   Single-user login system with bcrypt password hashing.
    *   Encrypted session management using Fernet for enhanced security.
*   **User-Friendly Interface:**
    *   Intuitive web interface for pasting news, selecting options, and viewing results.
    *   Copy/paste functionality for efficient workflow.
    *   Displays current Nepali date and time.
*   **Robust Backend:**
    *   Built with FastAPI for high performance and asynchronous operations.
    *   SQLite database for session and activity logging.
    *   Comprehensive logging for monitoring and debugging.
    *   Health check and metrics endpoints.

## üöÄ Technologies Used

*   **Backend:** Python (FastAPI, `aiohttp`, `requests`, `pydantic`, `passlib`, `cryptography`, `psutil`, `sqlite3`)
*   **Frontend:** HTML, CSS, JavaScript
*   **AI APIs:** Azure AI Inference, OpenRouter, Puter.com
*   **Database:** SQLite
*   **Deployment:** Render.com
*   **WordPress:** Custom REST API plugin

## ‚öôÔ∏è Setup and Installation

### 1. Clone the Repository

```bash
git clone https://github.com/Erikoliva1/Rewrite-Publish.git
cd Rewrite-Publish
```

### 2. Environment Variables

Create a `.env` file in the root directory of your project. **Do NOT commit this file to Git.**

```dotenv
API_KEY="sk-or-YOUR_OPENROUTER_API_KEY"
GITHUB_TOKEN="ghp_YOUR_GITHUB_TOKEN_FOR_AZURE_AI"
ACCESS_PASSWORD_HASH="YOUR_BCRYPT_HASH_FOR_LOGIN_PASSWORD"
WORDPRESS_API_TOKEN="YOUR_CUSTOM_WORDPRESS_PLUGIN_API_TOKEN"
WORDPRESS_APP_PASSWORD="YOUR_WORDPRESS_API_USERNAME:YOUR_WORDPRESS_APPLICATION_PASSWORD"
WORDPRESS_SITE_URL="https://www.your-wordpress-site.com"
FERNET_KEY="YOUR_FERNET_ENCRYPTION_KEY"
```

**How to get these values:**

*   **`API_KEY` (OpenRouter):** Obtain from [OpenRouter.ai](https://openrouter.ai/).
*   **`GITHUB_TOKEN`:** Generate a Personal Access Token (PAT) from GitHub with `repo` and `workflow` scopes if needed, or specific scopes required by `models.github.ai`. This is used for Azure AI Inference authentication.
*   **`ACCESS_PASSWORD_HASH`:** Generate a bcrypt hash for your desired login password. You can do this in a Python console:
    ```python
    from passlib.hash import bcrypt
    print(bcrypt.hash("your_secret_password"))
    ```
    Copy the output string (e.g., `\$2b\$12\$...`).
*   **`WORDPRESS_API_TOKEN`:** This is generated by the custom WordPress plugin (see step 3).
*   **`WORDPRESS_APP_PASSWORD`:**
    1.  In your WordPress admin, go to `Users` -> `Profile`.
    2.  Scroll down to "Application Passwords".
    3.  Create a new application password for a dedicated user (e.g., `admin` with an "Editor" role, **not Administrator**).
    4.  The format is `username:application_password`.
*   **`WORDPRESS_SITE_URL`:** The full URL to your WordPress site (e.g., `https://www.your-wordpress-site.com`).
*   **`FERNET_KEY`:** Generate a Fernet key in a Python console:
    ```python
    from cryptography.fernet import Fernet
    print(Fernet.generate_key().decode())
    ```
    Copy the output string.

### 3. WordPress Plugin Installation

1.  Locate the `news-rewrite-onrender.php` file in this repository.
2.  Upload this file to your WordPress site's plugins directory (e.g., `wp-content/plugins/`). You can do this via FTP/SFTP or your hosting provider's file manager.
3.  In your WordPress admin dashboard, go to `Plugins` -> `Installed Plugins`.
4.  Find "News Rewrite on Render" and click "Activate".
5.  Go to `Settings` -> `News Rewrite Settings`.
6.  Copy the "WordPress API Token" displayed there and paste it into your `.env` file as `WORDPRESS_API_TOKEN`.
7.  **Crucially, ensure the WordPress user specified in `WORDPRESS_APP_PASSWORD` (e.g., `admin`) exists and has at least an "Editor" role.** This plugin uses that user's credentials to create posts.

### 4. Install Python Dependencies

```bash
pip install -r requirements.txt
```

### 5. Run the Application Locally

```bash
uvicorn main:app --host 0.0.0.0 --port 5000
```

The application will be accessible at `http://localhost:5000`.

## üöÄ Deployment to Render.com

This project is configured for seamless deployment to Render.com using the `render.yaml` blueprint.

1.  **Commit your code:** Ensure all your project files (except `.env`) are committed and pushed to your GitHub repository.
2.  **Create a new Web Service on Render:**
    *   Go to your [Render Dashboard](https://dashboard.render.com/).
    *   Click "New Web Service".
    *   Connect your GitHub repository.
    *   Render will detect the `render.yaml` file and pre-fill most settings.
3.  **Set Environment Variables on Render:**
    *   **This is critical.** In the Render service creation page, navigate to the "Environment Variables" section.
    *   Add all the variables from your `.env` file (except `WORDPRESS_SITE_URL` if it's hardcoded in `render.yaml`) with their respective values. Ensure sensitive variables are marked as `sync: false`.
4.  **Deploy:** Click "Create Web Service". Render will automatically build and deploy your application.

Render will provide a public URL for your deployed application (e.g., `https://your-app-name.onrender.com`).

## üìù Usage

1.  **Access the Application:** Open the application URL in your browser (e.g., `http://localhost:5000` or your Render.com URL).
2.  **Login:** Enter your `ACCESS_PASSWORD` to log in.
3.  **Paste News:** Paste the original news article into the "Paste your news here..." textarea.
4.  **Select API:** Choose your preferred AI model from the "Select API" dropdown.
5.  **Image Upload (Optional):**
    *   Select a featured image file.
    *   Click "Apply Watermark" to add the "The Rim Online" watermark.
    *   Click "Upload to WordPress" to send the watermarked image to your WordPress media library. The media ID will be stored.
6.  **Rewrite News:** Click "Submit" to send the news to the selected AI model for rewriting. The rewritten content will appear in the result box.
7.  **Publish to WordPress:**
    *   Select relevant categories from the dynamically loaded checkboxes.
    *   Click "Publish" to create a new post on your WordPress site with the rewritten content and featured image (if uploaded).
    *   Click "Save as Draft" to save the post as a draft on WordPress.
8.  **Other Actions:**
    *   "Clear": Clears all fields.
    *   "Copy Result": Copies the rewritten news to your clipboard.
    *   "Paste": Pastes content from your clipboard into the news input.
    *   "Logout": Ends your session.

## ü§ù Contributing

Contributions are welcome! If you find a bug or have a feature request, please open an issue.

## üìß Contact

For any inquiries, please contact:

*   **Prabhat Yadav**
*   Email: prabhatyadav2003@gmail.com

---

**&copy; The Rim Online ‚Äî All Rights Reserved**
